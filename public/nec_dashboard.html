<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEC Member Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-blue-700 rounded-lg flex items-center justify-center font-bold text-lg">
                        NEC
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">National Executive Committee</h1>
                        <p class="text-blue-200 text-sm">Member Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-blue-200" id="user-welcome">Welcome, Loading...</span>
                    <div class="w-8 h-8 bg-blue-700 rounded-full flex items-center justify-center text-sm font-medium" id="user-initials">
                        LD
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <nav class="flex space-x-8 border-b border-gray-200 mb-8">
            <button onclick="showTab('overview')" id="tab-overview" class="tab-button py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-medium">
                National Overview
            </button>
            <button onclick="showTab('members')" id="tab-members" class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                NEC Members
            </button>
            <button onclick="showTab('branches')" id="tab-branches" class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                Branch Management
            </button>
            <button onclick="showTab('policies')" id="tab-policies" class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                Policy Management
            </button>
        </nav>

        <div id="overview-tab" class="tab-content fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <div class="w-6 h-6 bg-blue-600 rounded"></div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Branches</p>
                            <p class="text-2xl font-bold text-gray-900" id="total-branches-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <div class="w-6 h-6 bg-green-600 rounded"></div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Active Members</p>
                            <p class="text-2xl font-bold text-gray-900" id="total-members-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-purple-100 rounded-lg">
                            <div class="w-6 h-6 bg-purple-600 rounded"></div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Alumni Network</p>
                            <p class="text-2xl font-bold text-gray-900" id="total-alumni-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="p-2 bg-orange-100 rounded-lg">
                            <div class="w-6 h-6 bg-orange-600 rounded"></div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Events This Month</p>
                            <p class="text-2xl font-bold text-gray-900" id="events-this-month">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Recent Branch Activity</h3>
                    </div>
                    <div class="p-6" id="recent-activity">
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Top Performing Branches</h3>
                    </div>
                    <div class="p-6" id="top-branches">
                    </div>
                </div>
            </div>
        </div>

        <div id="members-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-medium text-gray-900">NEC Members Management</h3>
                    <button onclick="openMemberModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Add New Member
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Branch</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="members-table" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="branches-tab" class="tab-content hidden">
            <div class="mb-6">
                <button onclick="openBranchModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    Add New Branch
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="branches-grid">
            </div>
        </div>

        <div id="policies-tab" class="tab-content hidden">
            <div class="mb-6">
                <button onclick="openPolicyModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    Create New Policy
                </button>
            </div>

            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">National Policies & Announcements</h3>
                </div>
                <div class="divide-y divide-gray-200" id="policies-list">
                </div>
            </div>
        </div>
    </div>

    <div id="member-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900" id="member-modal-title">Add New NEC Member</h3>
            </div>
            <form id="member-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="member-name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="member-email" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                    <select id="member-position" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Position</option>
                        <option value="National President">National President</option>
                        <option value="Vice President">Vice President</option>
                        <option value="Secretary General">Secretary General</option>
                        <option value="Treasurer">Treasurer</option>
                        <option value="Regional Coordinator">Regional Coordinator</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Branch</label>
                    <select id="member-branch" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Branch</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeMemberModal()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save Member
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="branch-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Add New Branch</h3>
            </div>
            <form id="branch-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Branch Name</label>
                    <input type="text" id="branch-name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">University</label>
                    <input type="text" id="branch-university" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Province</label>
                    <input type="text" id="branch-province" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeBranchModal()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Create Branch
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="policy-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Create New Policy</h3>
            </div>
            <form id="policy-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Policy Title</label>
                    <input type="text" id="policy-title" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="policy-description" rows="4" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Applies To</label>
                    <select id="policy-scope" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="All Branches">All Branches</option>
                        <option value="Specific Branch">Specific Branch</option>
                        <option value="NEC Members Only">NEC Members Only</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closePolicyModal()" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Create Policy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        var API_BASE = '/api';
        var currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Guest', role: 'member' };
        var branchesData = [];
        var usersData = [];
        var eventsData = [];
        var alumniData = [];
        var newsData = [];

        function initializeDashboard() {
            updateUserInfo();
            loadAllData();
            
            setInterval(function() {
                loadAllData();
            }, 300000);
        }

        function updateUserInfo() {
            document.getElementById('user-welcome').textContent = 'Welcome, ' + currentUser.name;
            document.getElementById('user-initials').textContent = getInitials(currentUser.name);
        }

        function getInitials(name) {
            return name.split(' ').map(function(word) { return word[0]; }).join('').toUpperCase();
        }

        function loadAllData() {
            loadBranches();
            loadUsers();
            loadEvents();
            loadAlumni();
            loadNews();
        }

        function loadBranches() {
            fetch(API_BASE + '/branches')
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(branches) {
                    branchesData = branches;
                    updateBranchesCount();
                    populateBranchesGrid();
                    populateBranchDropdown();
                    updateTopBranches();
                })
                .catch(function(error) {
                    console.error('Error loading branches:', error);
                });
        }

        function loadUsers() {
            fetch(API_BASE + '/users')
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(users) {
                    usersData = users;
                    updateMembersCount();
                    populateNECMembersTable();
                })
                .catch(function(error) {
                    console.error('Error loading users:', error);
                });
        }

        function loadEvents() {
            fetch(API_BASE + '/events')
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(events) {
                    eventsData = events;
                    updateEventsCount();
                    updateRecentActivity();
                })
                .catch(function(error) {
                    console.error('Error loading events:', error);
                });
        }

        function loadAlumni() {
            fetch(API_BASE + '/alumni')
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(alumni) {
                    alumniData = alumni;
                    updateAlumniCount();
                })
                .catch(function(error) {
                    console.error('Error loading alumni:', error);
                });
        }

        function loadNews() {
            fetch(API_BASE + '/news')
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(news) {
                    newsData = news;
                    populatePoliciesList();
                })
                .catch(function(error) {
                    console.error('Error loading news:', error);
                });
        }

        function updateBranchesCount() {
            document.getElementById('total-branches-count').textContent = branchesData.length;
        }

        function updateMembersCount() {
            var activeMembers = usersData.filter(function(user) {
                return user.status === 'active';
            }).length;
            document.getElementById('total-members-count').textContent = activeMembers;
        }

        function updateAlumniCount() {
            document.getElementById('total-alumni-count').textContent = alumniData.length;
        }

        function updateEventsCount() {
            var thisMonthEvents = eventsData.filter(function(event) {
                var eventDate = new Date(event.date);
                var now = new Date();
                return eventDate.getMonth() === now.getMonth() && eventDate.getFullYear() === now.getFullYear();
            }).length;
            document.getElementById('events-this-month').textContent = thisMonthEvents;
        }

        function populateBranchesGrid() {
            var grid = document.getElementById('branches-grid');
            grid.innerHTML = '';

            branchesData.forEach(function(branch) {
                var branchCard = document.createElement('div');
                branchCard.className = 'bg-white rounded-lg shadow p-6';
                branchCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="text-lg font-medium text-gray-900">${branch.name}</h4>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p>University: ${branch.university}</p>
                        <p>Province: ${branch.province}</p>
                        <p>Members: ${branch.member_count || 0}</p>
                        <p>Alumni: ${branch.alumni_count || 0}</p>
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button onclick="viewBranchDetails(${branch.id})" class="text-blue-600 hover:text-blue-800 text-sm">View Details</button>
                        <button onclick="editBranch(${branch.id})" class="text-gray-600 hover:text-gray-800 text-sm">Edit</button>
                    </div>
                `;
                grid.appendChild(branchCard);
            });
        }

        function populateNECMembersTable() {
            var tbody = document.getElementById('members-table');
            tbody.innerHTML = '';

            var necMembers = usersData.filter(function(user) {
                return user.role === 'admin' || user.nec_position !== null;
            });

            necMembers.forEach(function(member) {
                var branch = branchesData.find(function(b) { return b.id === member.branch_id; });
                var row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-medium">
                                ${getInitials(member.name)}
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${member.name}</div>
                                <div class="text-sm text-gray-500">${member.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${member.nec_position || 'NEC Member'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${branch ? branch.name : 'National'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${member.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editMember(${member.id})" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                        <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-900">Remove</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateBranchDropdown() {
            var dropdown = document.getElementById('member-branch');
            dropdown.innerHTML = '<option value="">Select Branch</option>';
            
            branchesData.forEach(function(branch) {
                var option = document.createElement('option');
                option.value = branch.id;
                option.textContent = branch.name;
                dropdown.appendChild(option);
            });
        }

        function updateTopBranches() {
            var container = document.getElementById('top-branches');
            container.innerHTML = '';

            var sortedBranches = branchesData.sort(function(a, b) {
                return (b.member_count || 0) - (a.member_count || 0);
            }).slice(0, 3);

            sortedBranches.forEach(function(branch) {
                var branchDiv = document.createElement('div');
                branchDiv.className = 'flex items-center justify-between mb-4 last:mb-0';
                branchDiv.innerHTML = `
                    <div>
                        <p class="text-sm font-medium text-gray-900">${branch.name}</p>
                        <p class="text-xs text-gray-500">${branch.member_count || 0} active members</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-bold text-green-600">${Math.round(((branch.member_count || 0) / usersData.length) * 100)}%</p>
                        <p class="text-xs text-gray-500">engagement</p>
                    </div>
                `;
                container.appendChild(branchDiv);
            });
        }

        function updateRecentActivity() {
            var container = document.getElementById('recent-activity');
            container.innerHTML = '';

            var recentEvents = eventsData.sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 3);

            recentEvents.forEach(function(event) {
                var branch = branchesData.find(function(b) { return b.id === event.branch_id; });
                var activityDiv = document.createElement('div');
                activityDiv.className = 'flex items-center space-x-3 mb-4 last:mb-0';
                activityDiv.innerHTML = `
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900">${branch ? branch.name : 'Unknown Branch'} hosted: ${event.title}</p>
                        <p class="text-xs text-gray-500">${new Date(event.date).toLocaleDateString()}</p>
                    </div>
                `;
                container.appendChild(activityDiv);
            });
        }

        function populatePoliciesList() {
            var container = document.getElementById('policies-list');
            container.innerHTML = '';

            newsData.forEach(function(news) {
                var branch = branchesData.find(function(b) { return b.id === news.branch_id; });
                var policyDiv = document.createElement('div');
                policyDiv.className = 'p-6';
                policyDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="text-lg font-medium text-gray-900 mb-2">${news.title}</h4>
                            <p class="text-gray-600 mb-3">${news.content.substring(0, 100)}...</p>
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>Published: ${new Date(news.publish_date).toLocaleDateString()}</span>
                                <span>Branch: ${branch ? branch.name : 'National'}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editPolicy(${news.id})" class="text-blue-600 hover:text-blue-800">Edit</button>
                            <button onclick="deletePolicy(${news.id})" class="text-red-600 hover:text-red-800">Delete</button>
                        </div>
                    </div>
                `;
                container.appendChild(policyDiv);
            });
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function(tab) {
                tab.classList.add('hidden');
            });
            
            document.querySelectorAll('.tab-button').forEach(function(button) {
                button.classList.remove('border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            var activeButton = document.getElementById('tab-' + tabName);
            activeButton.classList.remove('border-transparent', 'text-gray-500');
            activeButton.classList.add('border-blue-500', 'text-blue-600');
        }

        function openMemberModal() {
            document.getElementById('member-modal').classList.remove('hidden');
            document.getElementById('member-modal').classList.add('flex');
        }

        function closeMemberModal() {
            document.getElementById('member-modal').classList.add('hidden');
            document.getElementById('member-modal').classList.remove('flex');
            document.getElementById('member-form').reset();
        }

        function editMember(id) {
            var member = usersData.find(function(u) { return u.id === id; });
            if (member) {
                openMemberModal();
                document.getElementById('member-modal-title').textContent = 'Edit NEC Member';
                document.getElementById('member-name').value = member.name;
                document.getElementById('member-email').value = member.email;
                document.getElementById('member-position').value = member.nec_position || '';
                document.getElementById('member-branch').value = member.branch_id || '';
            }
        }

        function deleteMember(id) {
            if (confirm('Are you sure you want to remove this NEC member?')) {
                fetch(API_BASE + '/users/' + id, {
                    method: 'DELETE'
                })
                .then(function(response) {
                    if (response.ok) {
                        loadUsers();
                        alert('Member removed successfully');
                    }
                })
                .catch(function(error) {
                    console.error('Error deleting member:', error);
                    alert('Error removing member');
                });
            }
        }

        document.getElementById('member-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var name = document.getElementById('member-name').value;
            var email = document.getElementById('member-email').value;
            var position = document.getElementById('member-position').value;
            var branchId = document.getElementById('member-branch').value;

            var userData = {
                name: name,
                email: email,
                role: 'admin',
                nec_position: position,
                branch_id: parseInt(branchId),
                status: 'active'
            };

            fetch(API_BASE + '/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(function(response) {
                if (response.ok) {
                    closeMemberModal();
                    loadUsers();
                    alert('NEC member added successfully');
                }
            })
            .catch(function(error) {
                console.error('Error adding member:', error);
                alert('Error adding member');
            });
        });

        function openBranchModal() {
            document.getElementById('branch-modal').classList.remove('hidden');
            document.getElementById('branch-modal').classList.add('flex');
        }

        function closeBranchModal() {
            document.getElementById('branch-modal').classList.add('hidden');
            document.getElementById('branch-modal').classList.remove('flex');
            document.getElementById('branch-form').reset();
        }

        function viewBranchDetails(branchId) {
            var branch = branchesData.find(function(b) { return b.id === branchId; });
            if (branch) {
                alert('Viewing details for ' + branch.name + '\nUniversity: ' + branch.university + '\nProvince: ' + branch.province);
            }
        }

        function editBranch(branchId) {
            var branch = branchesData.find(function(b) { return b.id === branchId; });
            if (branch) {
                alert('Editing branch: ' + branch.name);
            }
        }

        document.getElementById('branch-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var name = document.getElementById('branch-name').value;
            var university = document.getElementById('branch-university').value;
            var province = document.getElementById('branch-province').value;

            var branchData = {
                name: name,
                university: university,
                province: province,
                member_count: 0,
                alumni_count: 0
            };

            fetch(API_BASE + '/branches', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(branchData)
            })
            .then(function(response) {
                if (response.ok) {
                    closeBranchModal();
                    loadBranches();
                    alert('Branch created successfully');
                }
            })
            .catch(function(error) {
                console.error('Error creating branch:', error);
                alert('Error creating branch');
            });
        });

        function openPolicyModal() {
            document.getElementById('policy-modal').classList.remove('hidden');
            document.getElementById('policy-modal').classList.add('flex');
        }

        function closePolicyModal() {
            document.getElementById('policy-modal').classList.add('hidden');
            document.getElementById('policy-modal').classList.remove('flex');
            document.getElementById('policy-form').reset();
        }

        function editPolicy(id) {
            var news = newsData.find(function(n) { return n.id === id; });
            if (news) {
                alert('Editing policy: ' + news.title);
            }
        }

        function deletePolicy(id) {
            if (confirm('Are you sure you want to delete this policy?')) {
                fetch(API_BASE + '/news/' + id, {
                    method: 'DELETE'
                })
                .then(function(response) {
                    if (response.ok) {
                        loadNews();
                        alert('Policy deleted successfully');
                    }
                })
                .catch(function(error) {
                    console.error('Error deleting policy:', error);
                    alert('Error deleting policy');
                });
            }
        }

        document.getElementById('policy-form').addEventListener('submit', function(e) {
            e.preventDefault();
            var title = document.getElementById('policy-title').value;
            var description = document.getElementById('policy-description').value;
            var scope = document.getElementById('policy-scope').value;

            var newsData = {
                title: title,
                content: description,
                branch_id: 1,
                author_id: currentUser.id,
                publish_date: new Date().toISOString()
            };

            fetch(API_BASE + '/news', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newsData)
            })
            .then(function(response) {
                if (response.ok) {
                    closePolicyModal();
                    loadNews();
                    alert('Policy created successfully');
                }
            })
            .catch(function(error) {
                console.error('Error creating policy:', error);
                alert('Error creating policy');
            });
        });

        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('bg-opacity-50')) {
                closeMemberModal();
                closeBranchModal();
                closePolicyModal();
            }
        });

        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>